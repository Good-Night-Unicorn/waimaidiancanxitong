import{d as H,r as I,a as A,w as z,c as $,b,e,f as a,g as o,h as Q,i as _,o as m,F as S,j as U,k as x,l as g,_ as T,m as E,t as u,u as W,n as w,p as X,s as Y,q as Z,v as ee,E as te,x as se,y as ae,z as le,A as ne,B as oe}from"./index-d6e43adc.js";import{u as re}from"./order-9306be62.js";const ie={class:"filters card"},ue={class:"filters__row"},de={class:"filters__categories"},ce={class:"filters__sorting"},me={class:"filters__row secondary"},_e=H({__name:"RestaurantFilters",props:{categories:{},selectedCategory:{},sortBy:{},filters:{}},emits:["updateCategory","updateSort","updateFilters","reset"],setup(r,{emit:n}){const k=r,C=n,y=I(k.selectedCategory||"综合排序"),s=I(k.sortBy),c=A({...k.filters});z(()=>k.selectedCategory,l=>{y.value=l}),z(()=>k.sortBy,l=>{s.value=l}),z(()=>k.filters,l=>{Object.assign(c,l)},{deep:!0});const f=$(()=>[{label:"综合排序",value:"default"},{label:"评分最高",value:"rating"},{label:"销量最高",value:"sales"},{label:"距离最近",value:"distance"}]),R=l=>{C("updateCategory",l)},q=l=>{C("updateSort",l)},N=l=>{c.onlyDiscount=l,C("updateFilters",{onlyDiscount:l})},O=l=>{c.onlyFreeDelivery=l,C("updateFilters",{onlyFreeDelivery:l})},B=l=>{c.selfPickup=l,C("updateFilters",{selfPickup:l})},P=()=>{C("reset")};return(l,t)=>{const h=_("el-radio-button"),v=_("el-radio-group"),p=_("el-segmented"),i=_("el-check-tag"),D=_("el-button"),j=_("el-space");return m(),b("section",ie,[e("div",ue,[e("div",de,[t[2]||(t[2]=e("span",{class:"filters__label"},"商家分类：",-1)),a(v,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=V=>y.value=V),size:"small",onChange:R},{default:o(()=>[a(h,{label:"综合排序"}),(m(!0),b(S,null,U(r.categories,V=>(m(),x(h,{key:V,label:V},null,8,["label"]))),128))]),_:1},8,["modelValue"])]),e("div",ce,[t[3]||(t[3]=e("span",{class:"filters__label"},"排序：",-1)),a(p,{modelValue:s.value,"onUpdate:modelValue":t[1]||(t[1]=V=>s.value=V),options:f.value,onChange:q},null,8,["modelValue","options"])])]),e("div",me,[a(j,{alignment:"center",wrap:"",size:"16"},{default:o(()=>[a(i,{checked:c.onlyDiscount,onChange:N},{default:o(()=>[...t[4]||(t[4]=[g("满减优惠",-1)])]),_:1},8,["checked"]),a(i,{checked:c.onlyFreeDelivery,onChange:O},{default:o(()=>[...t[5]||(t[5]=[g("免配送费",-1)])]),_:1},8,["checked"]),a(i,{checked:c.selfPickup,onChange:B},{default:o(()=>[...t[6]||(t[6]=[g("到店自取",-1)])]),_:1},8,["checked"]),a(D,{link:"",type:"primary",onClick:P},{default:o(()=>[...t[7]||(t[7]=[g("重置条件",-1)])]),_:1})]),_:1}),Q(l.$slots,"extra",{},void 0,!0)])])}}});const pe=T(_e,[["__scopeId","data-v-4c14cbd2"]]),fe={class:"cover"},ye=["src","alt"],ve={class:"info"},ge={class:"info__header"},ke={class:"info__meta"},be={class:"info__categories"},he={key:0,class:"info__promotions"},Fe=H({__name:"RestaurantCard",props:{restaurant:{}},emits:["view"],setup(r){const n=r,k=$(()=>n.restaurant.rating);return(C,y)=>{const s=_("el-tag"),c=_("el-rate");return m(),b("article",{class:"restaurant-card card",onClick:y[1]||(y[1]=f=>C.$emit("view",r.restaurant))},[e("div",fe,[e("img",{src:r.restaurant.cover,alt:r.restaurant.name,loading:"lazy"},null,8,ye),r.restaurant.deliveryFee===0?(m(),x(s,{key:0,size:"small",type:"success",class:"cover__tag"},{default:o(()=>[...y[2]||(y[2]=[g("免配送费",-1)])]),_:1})):E("",!0)]),e("div",ve,[e("header",ge,[e("h3",null,u(r.restaurant.name),1),a(c,{modelValue:k.value,"onUpdate:modelValue":y[0]||(y[0]=f=>k.value=f),disabled:"","show-score":"","score-template":`${r.restaurant.rating.toFixed(1)}分`},null,8,["modelValue","score-template"])]),e("p",ke,[e("span",null,"月售 "+u(r.restaurant.monthlySales),1),e("span",null,"起送 ¥"+u(r.restaurant.startingFee),1),e("span",null,u(r.restaurant.deliveryTime)+" 分钟送达",1)]),e("p",be,[(m(!0),b(S,null,U(r.restaurant.categories.slice(0,3),f=>(m(),x(s,{key:f,size:"small"},{default:o(()=>[g(u(f),1)]),_:2},1024))),128))]),r.restaurant.promotions.length?(m(),b("div",he,[(m(!0),b(S,null,U(r.restaurant.promotions,f=>(m(),x(s,{key:f.label,type:f.type,size:"small",effect:"plain"},{default:o(()=>[g(u(f.label),1)]),_:2},1032,["type"]))),128))])):E("",!0)])])}}});const Ce=T(Fe,[["__scopeId","data-v-67f54604"]]),Ve={key:0,class:"detail page-container"},$e={class:"detail__grid"},De={class:"detail__main card"},xe={class:"detail__header"},Re=["src","alt"],Pe={class:"detail__header-info"},we={class:"summary"},Se={class:"meta"},Ue={class:"promotions"},Be={class:"menu"},ze={class:"menu__grid"},qe=["src","alt"],Ne={class:"menu__info"},Oe={class:"desc"},je={class:"sold"},Ee={class:"menu__actions"},Ie={class:"price"},Ae={class:"actions"},He={class:"quantity"},Te={class:"detail__aside card"},Le={class:"summary"},Me={class:"total"},Ke=H({__name:"RestaurantDetailPanel",props:{restaurant:{},contactName:{},contactPhone:{}},emits:["close"],setup(r){const n=r,k=W(),C=re(),y=I(),s=A({name:n.contactName??"",phone:n.contactPhone??"",address:"",remark:""});z(()=>[n.contactName,n.contactPhone],([l,t])=>{s.name=l??"",s.phone=t??""});const c=A({});z(()=>{var l;return(l=n.restaurant)==null?void 0:l.signatureDishes},l=>{l&&l.forEach(t=>{c[t.id]=c[t.id]??0})},{immediate:!0});const f=$(()=>n.restaurant?n.restaurant.signatureDishes.reduce((l,t)=>{const h=c[t.id]??0;return l+t.price*h},0):0),R=$(()=>n.restaurant?(f.value+n.restaurant.deliveryFee).toFixed(2):0),q=$(()=>f.value>0),N={name:[{required:!0,message:"请输入收货人姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}],address:[{required:!0,message:"请输入详细地址",trigger:"blur"}]},O=l=>{c[l.id]=(c[l.id]??0)+1},B=l=>{const t=c[l]??0;t<=0||(c[l]=t-1)},P=async()=>{if(!n.restaurant||!y.value||!await y.value.validate().catch(()=>!1))return;const t=n.restaurant.signatureDishes.filter(v=>(c[v.id]??0)>0).map(v=>({menuId:v.id,name:v.name,quantity:c[v.id]??0,price:v.price,image:v.image})),h=C.createOrder({restaurantId:n.restaurant.id,restaurantName:n.restaurant.name,items:t,goodsAmount:f.value,deliveryFee:n.restaurant.deliveryFee,contact:{name:s.name,phone:s.phone,address:s.address,remark:s.remark},note:s.remark});Object.keys(c).forEach(v=>{c[v]=0}),s.remark="",te.success("订单已提交，正在为您处理"),k.push({name:"order-detail",params:{id:h.id}})};return(l,t)=>{const h=_("el-icon"),v=_("el-button"),p=_("el-tag"),i=_("el-input"),D=_("el-form-item"),j=_("el-divider"),V=_("el-form");return r.restaurant?(m(),b("section",Ve,[e("div",$e,[e("div",De,[a(v,{type:"text",class:"back-button",onClick:t[0]||(t[0]=d=>l.$emit("close"))},{default:o(()=>[a(h,null,{default:o(()=>[a(w(X))]),_:1}),t[5]||(t[5]=g(" 返回 ",-1))]),_:1}),e("div",xe,[e("img",{src:r.restaurant.cover,alt:r.restaurant.name},null,8,Re),e("div",Pe,[e("h2",null,u(r.restaurant.name),1),e("p",we,[e("span",null,[a(h,null,{default:o(()=>[a(w(Y))]),_:1}),g(" "+u(r.restaurant.rating.toFixed(1))+" 分",1)]),e("span",null,"月售 "+u(r.restaurant.monthlySales),1),e("span",null,u(r.restaurant.deliveryTime)+" 分钟送达",1),e("span",null,"配送费 ¥"+u(r.restaurant.deliveryFee),1)]),e("p",Se," 起送价 ¥"+u(r.restaurant.startingFee)+" ｜ 营业时间 "+u(r.restaurant.businessHours),1),e("div",Ue,[(m(!0),b(S,null,U(r.restaurant.promotions,d=>(m(),x(p,{key:d.label,type:d.type,effect:"light"},{default:o(()=>[g(u(d.label),1)]),_:2},1032,["type"]))),128))])])]),e("div",Be,[t[6]||(t[6]=e("h3",{class:"section-title"},"菜单",-1)),e("div",ze,[(m(!0),b(S,null,U(r.restaurant.signatureDishes,d=>(m(),b("article",{key:d.id,class:"menu__item card"},[e("img",{src:d.image,alt:d.name},null,8,qe),e("div",Ne,[e("h4",null,u(d.name),1),e("p",Oe,u(d.description),1),e("p",je,"月售 "+u(d.soldMonthly),1),e("div",Ee,[e("strong",Ie,"¥"+u(d.price),1),e("div",Ae,[a(v,{type:"primary",circle:"",plain:"",size:"small",onClick:L=>B(d.id)},{default:o(()=>[a(h,null,{default:o(()=>[a(w(Z))]),_:1})]),_:1},8,["onClick"]),e("span",He,u(c[d.id]??0),1),a(v,{type:"primary",circle:"",size:"small",onClick:L=>O(d)},{default:o(()=>[a(h,null,{default:o(()=>[a(w(ee))]),_:1})]),_:1},8,["onClick"])])])])]))),128))])])]),e("aside",Te,[a(V,{"label-position":"top",model:s,rules:N,ref_key:"formRef",ref:y},{default:o(()=>[t[11]||(t[11]=e("h3",{class:"section-title"},"配送信息",-1)),a(D,{label:"收货人",prop:"name"},{default:o(()=>[a(i,{modelValue:s.name,"onUpdate:modelValue":t[1]||(t[1]=d=>s.name=d),placeholder:"请输入收货人姓名"},null,8,["modelValue"])]),_:1}),a(D,{label:"手机号",prop:"phone"},{default:o(()=>[a(i,{modelValue:s.phone,"onUpdate:modelValue":t[2]||(t[2]=d=>s.phone=d),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),a(D,{label:"收货地址",prop:"address"},{default:o(()=>[a(i,{modelValue:s.address,"onUpdate:modelValue":t[3]||(t[3]=d=>s.address=d),placeholder:"请输入详细地址"},null,8,["modelValue"])]),_:1}),a(D,{label:"备注"},{default:o(()=>[a(i,{modelValue:s.remark,"onUpdate:modelValue":t[4]||(t[4]=d=>s.remark=d),type:"textarea",rows:2,placeholder:"有什么特殊要求或口味偏好"},null,8,["modelValue"])]),_:1}),a(j),t[12]||(t[12]=e("h3",{class:"section-title"},"订单信息",-1)),e("div",Le,[e("p",null,[t[7]||(t[7]=g(" 商品金额 ",-1)),e("span",null,"¥"+u(f.value),1)]),e("p",null,[t[8]||(t[8]=g(" 配送费 ",-1)),e("span",null,"¥"+u(r.restaurant.deliveryFee.toFixed(2)),1)]),e("p",Me,[t[9]||(t[9]=g(" 合计 ",-1)),e("span",null,"¥"+u(R.value),1)])]),a(v,{type:"primary",size:"large",disabled:!q.value,block:"",onClick:P},{default:o(()=>[...t[10]||(t[10]=[g(" 提交订单 ",-1)])]),_:1},8,["disabled"])]),_:1},8,["model"])])])])):E("",!0)}}});const Ge=T(Ke,[["__scopeId","data-v-ca78a2e6"]]),Je={class:"home page-container"},Qe={class:"home__hero card"},We={class:"description"},Xe={class:"home__content"},Ye={class:"home__aside card"},Ze={class:"filters-list"},et={class:"home__main"},tt={key:1,class:"restaurant-grid"},st=H({__name:"HomePage",setup(r){const n=se(),k=ae(),C=le(),y=I(n.recommendedRestaurants[0]??null),s=A({category:n.state.filters.category,onlyDiscount:n.state.filters.onlyDiscount,onlyFreeDelivery:n.state.filters.onlyFreeDelivery,selfPickup:n.state.filters.selfPickup,sortBy:n.state.filters.sortBy}),c=$(()=>n.categoryOptions),f=$(()=>C.query.keyword);z(()=>f.value,p=>{n.updateSearchKeyword(p??"")},{immediate:!0});const R=$(()=>n.filteredRestaurants),q=$(()=>n.recommendedRestaurants.map(p=>p.name).join(" / ")),N=$(()=>{const p=n.cityOptions.find(i=>i.value===n.state.city);return p?p.label:"未选择"}),O=p=>{y.value=p},B=p=>{s.category=p,n.updateFilters({category:p})},P=()=>{n.updateFilters({onlyDiscount:s.onlyDiscount,onlyFreeDelivery:s.onlyFreeDelivery,selfPickup:s.selfPickup})},l=p=>{Object.assign(s,p),n.updateFilters(p)},t=p=>{s.sortBy=p,n.updateFilters({sortBy:p})},h=()=>{s.category="综合排序",s.onlyDiscount=!1,s.onlyFreeDelivery=!1,s.selfPickup=!1,s.sortBy="default",n.resetFilters()},v=$(()=>k.profile?"13800138000":"");return(p,i)=>{var K;const D=_("el-tag"),j=_("el-space"),V=_("el-icon"),d=_("el-menu-item"),L=_("el-menu"),G=_("el-divider"),M=_("el-switch"),J=_("el-empty");return m(),b("div",Je,[e("section",Qe,[e("div",null,[i[4]||(i[4]=e("p",{class:"subtitle"},"新鲜美食 快速送达 享受美味生活",-1)),i[5]||(i[5]=e("h1",null,"发现身边的优质餐厅",-1)),e("p",We,"精选"+u(R.value.length)+"家优质商家，满足你的每一次味蕾探索。",1),a(j,null,{default:o(()=>[a(D,{size:"large",type:"warning"},{default:o(()=>[g("城市："+u(N.value),1)]),_:1}),a(D,{size:"large",type:"success"},{default:o(()=>[g("今日推荐 "+u(q.value),1)]),_:1})]),_:1})]),i[6]||(i[6]=e("img",{src:"https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=800&q=80",alt:"美食推荐"},null,-1))]),e("section",Xe,[e("aside",Ye,[i[8]||(i[8]=e("h3",{class:"section-title"},"商家分类",-1)),a(L,{"default-active":s.category,class:"aside-menu",onSelect:B},{default:o(()=>[a(d,{index:"综合排序"},{default:o(()=>[a(V,null,{default:o(()=>[a(w(ne))]),_:1}),i[7]||(i[7]=e("span",null,"综合排序",-1))]),_:1}),(m(!0),b(S,null,U(c.value,F=>(m(),x(d,{key:F,index:F},{default:o(()=>[a(V,null,{default:o(()=>[a(w(oe))]),_:1}),e("span",null,u(F),1)]),_:2},1032,["index"]))),128))]),_:1},8,["default-active"]),a(G),i[9]||(i[9]=e("h3",{class:"section-title"},"热门筛选",-1)),e("div",Ze,[a(M,{modelValue:s.onlyDiscount,"onUpdate:modelValue":i[0]||(i[0]=F=>s.onlyDiscount=F),"active-text":"满减优惠",onChange:P},null,8,["modelValue"]),a(M,{modelValue:s.onlyFreeDelivery,"onUpdate:modelValue":i[1]||(i[1]=F=>s.onlyFreeDelivery=F),"active-text":"免配送费",onChange:P},null,8,["modelValue"]),a(M,{modelValue:s.selfPickup,"onUpdate:modelValue":i[2]||(i[2]=F=>s.selfPickup=F),"active-text":"到店自取",onChange:P},null,8,["modelValue"])])]),e("div",et,[a(pe,{categories:c.value,"selected-category":s.category,"sort-by":s.sortBy,filters:s,onUpdateCategory:B,onUpdateSort:t,onUpdateFilters:l,onReset:h},{extra:o(()=>[f.value?(m(),x(D,{key:0,type:"info",effect:"plain"},{default:o(()=>[g(" 搜索结果：“"+u(f.value)+"” ",1)]),_:1})):E("",!0)]),_:1},8,["categories","selected-category","sort-by","filters"]),R.value.length===0?(m(),x(J,{key:0,description:"暂时没有找到符合条件的餐厅，换个筛选试试吧"})):(m(),b("div",tt,[(m(!0),b(S,null,U(R.value,F=>(m(),x(Ce,{key:F.id,restaurant:F,onView:O},null,8,["restaurant"]))),128))]))])]),y.value?(m(),x(Ge,{key:0,restaurant:y.value,"contact-name":(K=w(k).profile)==null?void 0:K.username,"contact-phone":v.value,onClose:i[3]||(i[3]=F=>y.value=null)},null,8,["restaurant","contact-name","contact-phone"])):E("",!0)])}}});const nt=T(st,[["__scopeId","data-v-63e9c223"]]);export{nt as default};
